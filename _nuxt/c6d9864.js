(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{362:function(t,e,n){"use strict";n.d(e,"a",(function(){return j})),n.d(e,"d",(function(){return y})),n.d(e,"b",(function(){return x})),n.d(e,"c",(function(){return C}));n(26),n(15),n(19),n(31),n(32);var r=n(8),o=n(3),c=(n(23),n(47)),l=n.n(c),d=n(366),f=n.n(d),m=n(94),v=n.n(m);function h(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function _(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(Object(source),!0).forEach((function(e){Object(r.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):h(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var j="".concat("https://altitudeapp.altitude.co.th","/api/v1/user");function y(t,path){return f()(t,path)}function x(t,e){if(!t)return{"Content-Type":"application/json"};var n={"Content-Type":"application/json"};e&&(n={"Content-Type":"multipart/form-data"});var r=v.a.get("token");return r&&(n["auth-token"]="Bearer ".concat(r)),n}function w(t){return t.response&&401===t.response.status&&navigator.onLine&&(window.location.href="/no_permission?locale=".concat(window.$nuxt.$store.state.language)),t.response}function C(t,e,n){return O.apply(this,arguments)}function O(){return(O=Object(o.a)(regeneratorRuntime.mark((function t(e,n,r){var o,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=x(r.auth),c=_(_({},o),r.headers),t.prev=2,t.next=5,l()({method:e,url:n,headers:c,data:r.data,params:r.params});case 5:return d=t.sent,t.abrupt("return",d);case 9:return t.prev=9,t.t0=t.catch(2),t.abrupt("return",w(t.t0));case 12:return t.prev=12,t.finish(12);case 14:case"end":return t.stop()}}),t,null,[[2,9,12,14]])})))).apply(this,arguments)}},364:function(t,e,n){"use strict";n.d(e,"a",(function(){return m})),n.d(e,"b",(function(){return v})),n.d(e,"c",(function(){return h})),n.d(e,"d",(function(){return _}));n(365),n(70),n(16),n(71),n(72),n(67),n(68),n(44),n(40),n(33),n(15),n(42),n(43);var r=n(363),o=n.n(r),c=n(0),l=n.n(c);function d(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return c=t.done,t},e:function(t){l=!0,o=t},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function m(t){return t?l()(t).format("DD/MM/YYYY"):"-"}function v(t){return t?l()(t).local().format("DD/MM/YYYY HH:mm:ss"):"-"}function h(t){return t?Number(t).toFixed(0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):Number(0)}function _(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=new FormData;return o.a.each(t,(function(c,l){var f=l;if(e&&(f="".concat(e,"[").concat(l,"]")),o.a.includes(n,l))o.a.isArray(c)?o.a.forEach(c,(function(t,e){t instanceof File?(r.append("".concat(f,"[]"),t),r.delete("".concat(f,"[][").concat(e,"][][src]")),r.delete("".concat(f,"[][").concat(e,"][][index]"))):(t.action||(t.action="edit"),o.a.forEach(t,(function(t,e){r.append("".concat(f,"[][").concat(e,"]"),t)})))})):c instanceof File?(r.append("".concat(f),c),r.delete("".concat(f,"[").concat(l,"][][src]")),r.delete("".concat(f,"[").concat(l,"][][index]"))):r.append("".concat(f,"[").concat(l,"]"),c);else if(o.a.isArray(t[l])&&!o.a.isEmpty(t[l]))o.a.each(c,(function(t,n){if(f="".concat(l,"[]"),e&&(f="".concat(e,"[").concat(l,"][]")),o.a.isObject(c[n])&&!o.a.isEmpty(c[n])){var m,v=d(_(t,f).entries());try{for(v.s();!(m=v.n()).done;){var h=m.value;r.append(h[0],h[1])}}catch(t){v.e(t)}finally{v.f()}}else r.append("".concat(f),t)}));else if(o.a.isObject(t[l])){var m,v=d(_(c,f).entries());try{for(v.s();!(m=v.n()).done;){var h=m.value;r.append(h[0],h[1])}}catch(t){v.e(t)}finally{v.f()}}else r.append(f,c)})),r}},365:function(t,e,n){"use strict";var r=n(6),o=n(34),c=n(35),l=n(276),d=n(69),f=n(11),m=n(55).f,v=n(56).f,h=n(13).f,_=n(367).trim,j="Number",y=r.Number,x=y,w=y.prototype,C=c(n(93)(w))==j,O="trim"in String.prototype,$=function(t){var e=d(t,!1);if("string"==typeof e&&e.length>2){var n,r,o,c=(e=O?e.trim():_(e,3)).charCodeAt(0);if(43===c||45===c){if(88===(n=e.charCodeAt(2))||120===n)return NaN}else if(48===c){switch(e.charCodeAt(1)){case 66:case 98:r=2,o=49;break;case 79:case 111:r=8,o=55;break;default:return+e}for(var code,l=e.slice(2),i=0,f=l.length;i<f;i++)if((code=l.charCodeAt(i))<48||code>o)return NaN;return parseInt(l,r)}}return+e};if(!y(" 0o1")||!y("0b1")||y("+0x1")){y=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof y&&(C?f((function(){w.valueOf.call(n)})):c(n)!=j)?l(new x($(e)),n,y):$(e)};for(var k,D=n(9)?m(x):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),I=0;D.length>I;I++)o(x,k=D[I])&&!o(y,k)&&h(y,k,v(x,k));y.prototype=w,w.constructor=y,n(17)(r,j,y)}},366:function(t,e,n){var r,o,c;c=function(){function t(t){var e=[];if(0===t.length)return"";if("string"!=typeof t[0])throw new TypeError("Url must be a string. Received "+t[0]);if(t[0].match(/^[^/:]+:\/*$/)&&t.length>1){var n=t.shift();t[0]=n+t[0]}t[0].match(/^file:\/\/\//)?t[0]=t[0].replace(/^([^/:]+):\/*/,"$1:///"):t[0]=t[0].replace(/^([^/:]+):\/*/,"$1://");for(var i=0;i<t.length;i++){var component=t[i];if("string"!=typeof component)throw new TypeError("Url must be a string. Received "+component);""!==component&&(i>0&&(component=component.replace(/^[\/]+/,"")),component=i<t.length-1?component.replace(/[\/]+$/,""):component.replace(/[\/]+$/,"/"),e.push(component))}var r=e.join("/"),o=(r=r.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return r=o.shift()+(o.length>0?"?":"")+o.join("&")}return function(){return t("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},t.exports?t.exports=c():void 0===(o="function"==typeof(r=c)?r.call(e,n,e,t):r)||(t.exports=o)},367:function(t,e,n){var r=n(5),o=n(41),c=n(11),l=n(368),d="["+l+"]",f=RegExp("^"+d+d+"*"),m=RegExp(d+d+"*$"),v=function(t,e,n){var o={},d=c((function(){return!!l[t]()||"​"!="​"[t]()})),f=o[t]=d?e(h):l[t];n&&(o[n]=f),r(r.P+r.F*d,"String",o)},h=v.trim=function(t,e){return t=String(o(t)),1&e&&(t=t.replace(f,"")),2&e&&(t=t.replace(m,"")),t};t.exports=v},368:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},369:function(t,e,n){"use strict";var r=n(5),o=n(96)(5),c="find",l=!0;c in[]&&Array(1).find((function(){l=!1})),r(r.P+r.F*l,"Array",{find:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),n(95)(c)},370:function(t,e,n){"use strict";n.d(e,"a",(function(){return _}));var r=n(3),o=n(91),c=n(92),l=(n(45),n(23),n(363)),d=n.n(l),f=n(0),m=n.n(f),v=n(362),h=n(364),_=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(o.a)(this,t),this.json=e,this.json.answer_json_data=e.answer_json_data||[],this.json.attachments=e.attachments||[],this.json.due_datetime=m()(e.due_datetime).format()||null,this.json.description_translations=e.description_translations||{en:"",th:""}}var e,n,l,f;return Object(c.a)(t,[{key:"save",value:(f=Object(r.a)(regeneratorRuntime.mark((function t(e,n){var r,o,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=d.a.cloneDeep(this.json)).default_question_answer=r.answer_json_data[0].choice_text,r.answer_json_data=JSON.stringify(r.answer_json_data),r.asset_id=n,r.due_datetime=m()(r.due_datetime).unix(),o=Object(h.d)(r,"incident",["attachments"]),this.json.id){t.next=12;break}return t.next=9,Object(v.c)("post",Object(v.d)(v.a,"projects/".concat(e,"/incidents")),{headers:Object(v.b)(!0),data:o});case 9:c=t.sent,t.next=15;break;case 12:return t.next=14,Object(v.c)("patch",Object(v.d)(v.a,"projects/".concat(e,"/incidents/").concat(this.json.id)),{headers:Object(v.b)(!0),data:o});case 14:c=t.sent;case 15:return t.abrupt("return",c);case 16:case"end":return t.stop()}}),t,this)}))),function(t,e){return f.apply(this,arguments)})}],[{key:"index",value:(l=Object(r.a)(regeneratorRuntime.mark((function e(n,r,o){var c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(v.c)("get",Object(v.d)(v.a,"projects/".concat(n,"/incidents")),{params:{page:r,per_page:o},headers:Object(v.b)(!0)});case 2:return c=e.sent,l=d.a.map(c.data.incidents,(function(e,n){return new t(e)})),e.abrupt("return",{incidents:l,total_count:c.data.total_count});case 5:case"end":return e.stop()}}),e)}))),function(t,e,n){return l.apply(this,arguments)})},{key:"show",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",{});case 2:return e.next=4,Object(v.c)("get",Object(v.d)(v.a,"projects/".concat(n,"/incidents/").concat(r)),{headers:Object(v.b)(!0)});case 4:return o=e.sent,e.abrupt("return",new t(o.data.incident));case 6:case"end":return e.stop()}}),e)}))),function(t,e){return n.apply(this,arguments)})},{key:"complete",value:(e=Object(r.a)(regeneratorRuntime.mark((function t(e,n,r){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=Object(h.d)(r.json,"incident"),t.next=3,Object(v.c)("patch",Object(v.d)(v.a,"projects/".concat(e,"/incidents/").concat(n,"/complete")),{headers:Object(v.b)(!0),data:o});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)}))),function(t,n,r){return e.apply(this,arguments)})}]),t}()},371:function(t,e,n){t.exports=n.p+"img/phone.effef9c.png"},381:function(t,e,n){var content=n(413);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(25).default)("0bff4765",content,!0,{sourceMap:!1})},382:function(t,e,n){var content=n(415);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(25).default)("feb4a880",content,!0,{sourceMap:!1})},412:function(t,e,n){"use strict";n(381)},413:function(t,e,n){var r=n(24)(!1);r.push([t.i,".gk-content-background{background:#fff}",""]),t.exports=r},414:function(t,e,n){"use strict";n(382)},415:function(t,e,n){var r=n(24)(!1);r.push([t.i,".title[data-v-4924580c]{font-weight:600;padding-top:10px;margin-bottom:10px;text-align:left!important}.default-button[data-v-4924580c]{font-weight:700;font-size:14px;height:40px;width:100px}.button-text[data-v-4924580c]{color:#fff;margin-bottom:10px}.custom-content[data-v-4924580c]{padding:5pt}.custom-content .ivu-row[data-v-4924580c]{margin:5px 0;word-wrap:break-word}.custom-content .label[data-v-4924580c]{font-weight:600;margin-right:10px}[data-v-4924580c] .ivu-rate-star-chart{margin-left:5px;margin-right:0}.incident-content[data-v-4924580c]{background:#2b1505;color:#bd6e51;border-radius:0;border:1px solid #2b1505}[data-v-4924580c] .ivu-collapse,[data-v-4924580c] .ivu-collapse-item:last-child>.ivu-collapse-content{background:#f0ebe3}[data-v-4924580c] .ivu-select{border-radius:20px;border-color:#c47055;background:#000}[data-v-4924580c] .ivu-collapse{border-radius:5px!important}[data-v-4924580c] .ivu-collapse>.ivu-collapse-item.ivu-collapse-item-active>.ivu-collapse-header{border:none!important}[data-v-4924580c] .ivu-collapse-content>.ivu-collapse-content-box{padding-top:0;padding-bottom:0}[data-v-4924580c] .ivu-carousel-arrow.left{left:-4px!important;color:#cf795b;font-size:30px}[data-v-4924580c] .ivu-carousel-arrow.right{right:-4px!important;color:#cf795b;font-size:30px}",""]),t.exports=r},443:function(t,e,n){"use strict";n.r(e);n(26),n(15),n(31),n(32);var r=n(3),o=n(30),c=n(8),l=(n(23),n(19),n(369),n(45),n(67),n(68),n(16),n(40),n(363)),d=n.n(l),f=n(370),m=n(91),v=n(92),h=n(362),_=n(364);function j(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function y(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?j(Object(source),!0).forEach((function(e){Object(c.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):j(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var x=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(m.a)(this,t),this.json=y(y({},e),{},{attachments:e.attachments||[]})}var e,n;return Object(v.a)(t,[{key:"save",value:(n=Object(r.a)(regeneratorRuntime.mark((function t(e,n){var r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object(_.d)(this.json,"incident_action",["attachments"]),t.next=3,Object(h.c)("post",Object(h.d)(h.a,"projects/".concat(e,"/incidents/").concat(n,"/incident_actions")),{data:r,headers:Object(h.b)(!0)});case 3:return o=t.sent,t.abrupt("return",o);case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})}],[{key:"index",value:(e=Object(r.a)(regeneratorRuntime.mark((function e(n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.c)("get",Object(h.d)(h.a,"projects/".concat(n,"/incidents/").concat(r,"/incident_actions")),{headers:Object(h.b)(!0)});case 2:if(200!==(o=e.sent).status){e.next=5;break}return e.abrupt("return",Object(l.map)(o.data.incident_actions,(function(e){return new t(e)})));case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)}))),function(t,n){return e.apply(this,arguments)})}]),t}();function w(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function C(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?w(Object(source),!0).forEach((function(e){Object(c.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):w(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var O={filters:{formatDate:function(t){return t?Object(_.a)(t):"-"}},data:function(){return{carouselValue:1,carouselImagePages:0,carouselVideoPages:0,iconPhone:n(371),incident:{json:{}},incidentActions:[],isLoading:!0,collapseName:"comment",commentFormData:new x,completeFormData:{json:{rating:null,note:""}},deviceName:"",expiredDatetime:"",visibleAddComment:!1,visibleComplete:!1,visiblePreview:!1,rating:null,toggleCollapse:!1,setting:{dots:"none",radiusDot:!0,trigger:"hover",arrow:"always"}}},computed:{fields:function(){return d.a.isEmpty(this.incident.json.incident_type)?[]:this.incident.json.incident_type.questions},language:function(){return this.$store.state.language},headerName:function(){return this.$nuxt.$store.getters.getLandingPageHeader}},mounted:function(){this.$nuxt.isOffline2?this.$router.push({name:"lost_internet_connection",params:{currentLanguage:this.language}}):(this.fetchIncident(),this.fetchIncidentAction())},methods:{formatDatetime:_.b,closeModal:function(){this.visibleComplete=!1,this.rating=null,this.completeFormData.json.rating=null,this.completeFormData.json.note=""},convertDescription:function(t){return"Complete this incident."===t||"ปิดเรื่องนี้"===t?this.$t("form.incident.label.status_complete"):"Change status to pending Approval."===t||"เปลี่ยนสถานะเป็นรอการอนุมัติ"===t?this.$t("form.incident.label.status_change_to"):"Cancel this incident."===t||"ยกเลิกเรื่องนี้"===t?this.$t("form.incident.label.status_cancelled"):t},previewAction:function(t){var e=this;setTimeout((function(){e.$refs.carousel.handleResize()}),500),this.carouselValue=t,this.visiblePreview=!0},gotRating:function(t){t&&(this.completeFormData.json.rating=t)},fetchIncident:function(){var t=this;f.a.show(this.$route.params.projectId,this.$route.params.incidentId).then((function(e){t.incident=e,t.incident.json.incident_images=d.a.filter(t.incident.json.attachments,{content_type:"image/jpeg"}),t.incident.json.incident_videos=d.a.filter(t.incident.json.attachments,{content_type:"video/quicktime"});var n=t.incident.json.incident_images.length/2;n+=n%2,t.carouselImagePages=parseInt(n);var r=t.incident.json.incident_videos.length/2;if(r+=r%2,t.carouselVideoPages=parseInt(r),t.incident.json.description_translations){var o=t.incident.json.description_translations[t.language].indexOf("#");t.deviceName=t.incident.json.description_translations[t.language].substring(o,0);var c=t.incident.json.description_translations[t.language].indexOf("*");t.expiredDatetime=t.incident.json.description_translations[t.language].substring(o+2,c)}})).catch((function(){t.incident=new f.a}))},fetchIncidentAction:function(){var t=this;x.index(this.$route.params.projectId,this.$route.params.incidentId).then((function(e){t.incidentActions=e,t.isLoading=!1})).catch((function(){t.incidentActions=[],t.isLoading=!1}))},updateFormData:function(t){this.commentFormData.json=C(C({},this.commentFormData.json),t)},getFieldValue:function(t){var e=this,n=d.a.find(this.incident.json.answer_json_data,["question_id",t]);if(!n)return"-";if(Array.isArray(n.choice_text)){var r="";return d.a.map(n.choice_text,(function(t,n){r+="".concat(n>0&&n!==t.length-1?", ":"").concat(t[e.language])})),r}return"object"!==Object(o.a)(n.choice_text)?n.choice_text:n.choice_text?n.choice_text[this.language]:void 0},filterAttachments:function(t,e){var n=[];return d.a.map(t,(function(t){d.a.includes(t.content_type,e)&&n.push(t)})),n},handleCommentSubmit:function(){var t=this;if(!(this.commentFormData.json.attachments.length<0)&&this.commentFormData.json.description)return new Promise((function(e){t.$Modal.confirm({title:t.$t("messages.are_you_sure"),content:t.$t("messages.confirm_save"),okText:t.$t("button.yes"),cancelText:t.$t("button.no"),onOk:function(){t.submitCommentForm()}})}));this.$Message.error(this.$t("info.incident.label.comment")+this.$t("errors.cannot_be_blank"))},submitCommentForm:function(t){var e=this;this.$nuxt.isOffline?this.$router.push({name:"lost_internet_connection",params:{currentLanguage:this.language}}):this.$refs.commentForm.validate(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(r){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!r&&!t){n.next=7;break}return n.next=3,e.commentFormData.save(e.$route.params.projectId,e.incident.json.id);case 3:o=n.sent,e.isLoading=!0,t?(e.fetchIncident(),e.fetchIncidentAction()):o.data&&o.data.success?(e.$Message.success(e.$t("info.incident.label.comment")+e.$t("messages.successfully_created")),e.visibleAddComment=!1,e.$refs.commentForm.resetFields(),e.fetchIncident(),e.fetchIncidentAction()):e.$Message.error({content:e.$t("messages.fail")}),e.isLoading=!1;case 7:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())},handleCompleteSubmit:function(){var t=this;if(this.completeFormData.json.rating)return new Promise((function(e){t.$Modal.confirm({title:t.$t("messages.are_you_sure"),content:t.$t("messages.confirm_save"),okText:t.$t("button.yes"),cancelText:t.$t("button.no"),onOk:function(){t.completeIncident()}})}));this.$Message.error({content:this.$t("info.incident.label.rating"),duration:3})},completeIncident:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.$nuxt.isOffline){e.next=4;break}t.$router.push({name:"lost_internet_connection",params:{currentLanguage:t.language}}),e.next=8;break;case 4:return e.next=6,f.a.complete(t.$route.params.projectId,t.$route.params.incidentId,t.completeFormData);case 6:200===e.sent.status?(t.commentFormData.json.description=t.$t("form.incident.label.status_complete"),t.submitCommentForm(!0),t.$Message.success(t.$t("messages.successfully_complete")),t.visibleComplete=!1,t.$refs.completeForm.resetFields(),t.fetchIncident()):t.$Message.error({content:t.$t("messages.fail")});case 8:case"end":return e.stop()}}),e)})))()},sliceAttachments:function(t,e){return e?this.incident.json.incident_images.slice(2*(t-1),2*t):this.incident.json.incident_videos.slice(2*(t-1),2*t)},sliceVideos:function(t){},statusColor:function(t){return"opened"===t?"gold":"pending_approval"===t?"blue":"completed"===t?"green":"red"},convertStatus:function(t){return"opened"===t?this.$t("statuses.opened"):"completed"===t?this.$t("statuses.completed"):"pending_approval"===t?this.$t("statuses.pending_approval"):this.$t("statuses.cancelled")}}},$=(n(412),n(414),n(27)),component=Object($.a)(O,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.isLoading?n("GLoading"):n("div",[n("div",{staticClass:"custom-content"},[n("Card",{staticClass:"header-content",attrs:{bordered:!1,"dis-hover":"",padding:0}},[n("Row",{staticClass:"mt-8 ml-20 mr-20",attrs:{type:"flex",justify:"space-between"}},[n("Col",[n("p",{staticClass:"header-font-size"},[t._v("\n            "+t._s(t.headerName)+"\n          ")])]),t._v(" "),n("Col",[n("img",{staticClass:"header-icon",attrs:{src:t.iconPhone}})])],1)],1),t._v(" "),n("Card",{staticClass:"incident-content",attrs:{bordered:!1,"dis-hover":"",padding:0}},[n("Row",{staticClass:"fix-show-text ml-20"},[n("span",{staticClass:"label"},[t._v("\n          "+t._s(t.$t("info.incident.label.incident_type")+":")+"\n        ")]),t._v(" "),t.incident.json.incident_type?n("span",[t._v("\n          "+t._s(t.incident.json.incident_type.name_translations[t.language])+"\n        ")]):t._e()]),t._v(" "),t.deviceName&&t.expiredDatetime?n("Row",{staticClass:"ml-20"},[n("span",{staticClass:"label"},[t._v("\n          "+t._s(t.$t("info.incident.label.device_info")+":")+"\n        ")]),t._v(" "),n("Col",[n("span",[t._v("\n            "+t._s("- "+t.$t("info.incident.label.device_name")+":")+"\n          ")]),t._v(" "),n("span",[t._v("\n            "+t._s(t.deviceName)+"\n          ")])]),t._v(" "),n("Col",[n("span",[t._v("\n            "+t._s("- "+t.$t("info.incident.label.warranty_expired_datetime")+":")+"\n          ")]),t._v(" "),n("span",[t._v("\n            "+t._s(t._f("formatDate")(t.expiredDatetime))+"\n          ")])])],1):t._e(),t._v(" "),t._l(t.fields,(function(e){return n("Row",{key:e.id,staticClass:"fix-show-text ml-20"},[n("span",{staticClass:"label"},[t._v("\n          "+t._s(e.question_text_translations[t.language]+":")+"\n        ")]),t._v(" "),n("span",[t._v("\n          "+t._s(t.getFieldValue(e.id))+"\n        ")])])})),t._v(" "),n("Row",{staticClass:"ml-20"},[n("span",{staticClass:"label"},[t._v("\n          "+t._s(t.$t("info.incident.label.due_datetime")+":")+"\n        ")]),t._v(" "),t.incident.json.due_datetime?n("span",[t._v("\n          "+t._s(t._f("formatDate")(t.incident.json.due_datetime))+"\n        ")]):t._e()])],2),t._v(" "),n("Row",[t.filterAttachments(t.incident.json.attachments,"image").length>0?n("Col",{staticClass:"pt-20 pb-20",attrs:{span:"24"}},[n("div",{staticClass:"text-center text-bold pt-10 pb-10",staticStyle:{color:"#fff"}},[t._v("\n          "+t._s("รูปภาพ")+"\n        ")]),t._v(" "),n("Carousel",{attrs:{dots:t.setting.dots,"radius-dot":t.setting.radiusDot,trigger:t.setting.trigger,arrow:t.setting.arrow}},t._l(t.carouselImagePages,(function(e,r){return n("span",{key:r},[n("CarouselItem",[n("Row",{staticClass:"pt-10",attrs:{type:"flex",justify:"center"}},t._l(t.sliceAttachments(e,"isImage"),(function(image,e){return n("Col",{key:e,staticClass:"pr-5 pb-10"},[n("img",{staticStyle:{"border-radius":"10px","object-fit":"cover",width:"120px",height:"100px"},attrs:{src:image.url},on:{click:function(n){return t.previewAction(e)}}})])})),1)],1)],1)})),0)],1):t._e(),t._v(" "),t.filterAttachments(t.incident.json.attachments,"video").length>0?n("Col",{staticClass:"pt-10 pb-10",attrs:{span:"24"}},[n("div",{staticClass:"text-center text-bold pt-10 pb-10",staticStyle:{color:"#fff"}},[t._v("\n          "+t._s("วิดีโอ")+"\n        ")]),t._v(" "),n("Carousel",{attrs:{dots:t.setting.dots,"radius-dot":t.setting.radiusDot,trigger:t.setting.trigger,arrow:t.setting.arrow}},t._l(t.carouselVideoPages,(function(e,r){return n("span",{key:r},[n("CarouselItem",[n("Row",{staticClass:"pt-10",attrs:{type:"flex",justify:"center"}},t._l(t.sliceAttachments(e),(function(content,e){return n("Col",{key:e,staticClass:"pr-5"},[n("video",{staticStyle:{border:"1px solid #fff","border-radius":"10px"},attrs:{width:"120",height:"100",controls:"",src:content.url},on:{click:function(n){return t.previewAction(e)}}})])})),1)],1)],1)})),0)],1):t._e()],1),t._v(" "),n("div",{staticClass:"pl-10 pr-10"},[n("Collapse",{staticStyle:{"border-color":"#b3b3b3","border-radius":"10px"},model:{value:t.collapseName,callback:function(e){t.collapseName=e},expression:"collapseName"}},[n("Panel",{attrs:{name:"comment","hide-arrow":""},nativeOn:{click:function(e){t.toggleCollapse=!t.toggleCollapse}}},[n("Row",{attrs:{type:"flex",justify:"space-between"}},[n("Col",{staticClass:"text-bold",staticStyle:{color:"#a05435"}},[t._v("\n              "+t._s(t.$t("info.incident.label.comment"))+"\n            ")]),t._v(" "),n("Col",{staticClass:"pr-10"},[t.toggleCollapse?n("Icon",{attrs:{type:"ios-arrow-down"}}):n("Icon",{attrs:{type:"ios-arrow-up"}})],1)],1),t._v(" "),t.toggleCollapse?t._e():n("div",{staticClass:"pl-10 pr-10",staticStyle:{"border-bottom":"1px solid #130e07","border-color":"#b3b3b3","margin-right":"18px"}}),t._v(" "),t.incidentActions.length>0?n("div",{staticStyle:{background:"#f0ebe3"},attrs:{slot:"content"},slot:"content"},t._l(t.incidentActions,(function(e){return n("div",{key:e.json.id,staticClass:"incident-list",staticStyle:{"border-bottom":"1px solid #130e07","border-color":"#b3b3b3",color:"#281608"}},[n("Row",[n("Col",{attrs:{span:"24"}},[e.json.description?n("span",{staticClass:"fix-show-text"},[t._v("\n                    "+t._s(t.convertDescription(e.json.description))+"\n                  ")]):t._e(),t._v(" "),n("br"),t._v(" "),"Complete this incident."!==e.json.description&&"ปิดเรื่องนี้"!==e.json.description||!t.incident.json.note?t._e():n("span",{staticClass:"fix-show-text"},[t._v("\n                    "+t._s(t.incident.json.note)+"\n                  ")])]),t._v(" "),t.filterAttachments(e.json.attachments,"image").length>0?n("Col",{attrs:{span:"24"}},[n("div",{staticClass:"title"},[t._v("\n                    "+t._s(t.$t("info.incident.label.images")+":")+"\n                  ")]),t._v(" "),n("GGallery",{attrs:{"column-span":5,"column-offset":0,height:"60px",width:"60px",images:t.filterAttachments(e.json.attachments,"image")}})],1):t._e(),t._v(" "),t.filterAttachments(e.json.attachments,"video").length>0?n("Col",{attrs:{span:"24"}},[n("div",{staticClass:"title"},[t._v("\n                    "+t._s(t.$t("info.incident.label.videos")+":")+"\n                  ")]),t._v(" "),n("GGallery",{attrs:{"column-span":5,"column-offset":0,height:"60px",width:"60px",images:t.filterAttachments(e.json.attachments,"video")}})],1):t._e(),t._v(" "),n("Col",{staticStyle:{color:"#a05435","font-size":"12px"},attrs:{span:"24"}},[e.json.incident_actionable.role||e.json.incident_actionable.full_name?n("div",[t._v("\n                    "+t._s(""+e.json.incident_actionable.full_name)+"\n                  ")]):n("div",[t._v("\n                    "+t._s(e.json.incident_actionable["full_name_"+t.language]+"  "+t.formatDatetime(e.json.created_at)+" ")+"\n                  ")])]),t._v(" "),n("Col",{staticClass:"text-right",attrs:{span:"10"}},[n("div")])],1)],1)})),0):n("div",{staticClass:"text-center",attrs:{slot:"content"},slot:"content"},[n("div",{staticClass:"pt-10 pb-10"},[t._v("\n              "+t._s(t.$t("info.incident.label.no_comment"))+"\n            ")])])],1)],1)],1),t._v(" "),n("Row",{staticClass:"pt-20 pb-20",attrs:{type:"flex",justify:"center"}},[n("Col",{staticClass:"mr-10"},[n("Button",{staticStyle:{background:"#f0ebe3","border-radius":"20px",width:"140px"},attrs:{type:"primary",size:"large"},on:{click:function(e){t.visibleAddComment=!0}}},[n("p",{staticClass:"button-text",staticStyle:{color:"#603813"}},[t._v("\n            "+t._s(t.$t("button.add_comment"))+"\n          ")])])],1),t._v(" "),"pending_approval"===t.incident.json.status?n("Col",{staticClass:"ml-10"},[n("Button",{staticStyle:{"border-radius":"20px",width:"140px"},attrs:{type:"primary",size:"large"},on:{click:function(e){t.visibleComplete=!0}}},[n("p",{staticClass:"button-text"},[t._v("\n            "+t._s(t.$t("button.complete_incident"))+"\n          ")])])],1):t._e()],1)],1),t._v(" "),n("Modal",{attrs:{"footer-hide":""},model:{value:t.visibleAddComment,callback:function(e){t.visibleAddComment=e},expression:"visibleAddComment"}},[n("Form",{ref:"commentForm",attrs:{model:t.commentFormData.json}},[n("FormItem",{attrs:{prop:"description",label:t.$t("form.incident_action.label.description"),rules:[{required:!0,message:t.$t("form.incident_action.label.description")+t.$t("errors.cannot_be_blank"),trigger:"change"}]}},[n("Input",{attrs:{type:"textarea"},model:{value:t.commentFormData.json.description,callback:function(e){t.$set(t.commentFormData.json,"description",e)},expression:"commentFormData.json.description"}})],1),t._v(" "),n("FormItem",{attrs:{prop:"attachments"}},[n("p",[t._v(t._s(t.$t("form.incident_action.label.add_image_video")))]),t._v(" "),n("GUpload",{attrs:{"is-incident":"","field-key":"attachments",multiple:""},on:{updateParentValue:t.updateFormData},model:{value:t.commentFormData.json.attachments,callback:function(e){t.$set(t.commentFormData.json,"attachments",e)},expression:"commentFormData.json['attachments']"}})],1),t._v(" "),n("FormItem",[n("Row",{attrs:{type:"flex",justify:"center"}},[n("Col",{staticStyle:{"margin-right":"10px"}},[n("Button",{staticClass:"default-button button-grey",attrs:{size:"small"},on:{click:function(e){t.visibleAddComment=!1}}},[t._v("\n              "+t._s(t.$t("button.cancel"))+"\n            ")])],1),t._v(" "),n("Col",{staticStyle:{"margin-left":"10px"}},[n("Button",{staticClass:"default-button button-green",attrs:{size:"small"},on:{click:t.handleCommentSubmit}},[t._v("\n              "+t._s(t.$t("button.submit"))+"\n            ")])],1)],1)],1)],1)],1),t._v(" "),n("Modal",{attrs:{"footer-hide":""},model:{value:t.visibleComplete,callback:function(e){t.visibleComplete=e},expression:"visibleComplete"}},[n("Form",{ref:"completeForm",attrs:{model:t.completeFormData.json}},[n("FormItem",{attrs:{prop:"rating"}},[n("p",[t._v(t._s(t.$t("form.incident.label.rating")))]),t._v(" "),n("center",[n("Rate",{staticStyle:{"font-size":"40px"},attrs:{icon:"ios-heart",clearable:""},on:{"on-change":function(e){return t.gotRating(t.rating)}},model:{value:t.rating,callback:function(e){t.rating=e},expression:"rating"}})],1)],1),t._v(" "),n("FormItem",{attrs:{prop:"note"}},[n("p",[t._v(t._s(t.$t("form.incident.label.note")))]),t._v(" "),n("Input",{attrs:{type:"textarea"},model:{value:t.completeFormData.json.note,callback:function(e){t.$set(t.completeFormData.json,"note",e)},expression:"completeFormData.json.note"}})],1),t._v(" "),n("FormItem",[n("Row",{attrs:{type:"flex",justify:"center"}},[n("Col",{staticStyle:{"margin-right":"10px"}},[n("Button",{staticClass:"default-button button-grey",attrs:{size:"small"},on:{click:function(e){return t.closeModal()}}},[t._v("\n              "+t._s(t.$t("button.cancel"))+"\n            ")])],1),t._v(" "),n("Col",{staticStyle:{"margin-left":"10px"}},[n("Button",{staticClass:"default-button button-green",attrs:{size:"small"},on:{click:t.handleCompleteSubmit}},[t._v("\n              "+t._s(t.$t("button.complete_incident"))+"\n            ")])],1)],1)],1)],1)],1),t._v(" "),n("Modal",{attrs:{"footer-hide":""},model:{value:t.visiblePreview,callback:function(e){t.visiblePreview=e},expression:"visiblePreview"}},[n("Carousel",{ref:"carousel",attrs:{dots:t.setting.dots,"radius-dot":t.setting.radiusDot,trigger:t.setting.trigger,arrow:t.setting.arrow},model:{value:t.carouselValue,callback:function(e){t.carouselValue=e},expression:"carouselValue"}},t._l(t.incident.json.incident_images,(function(image,t){return n("span",{key:t},[n("CarouselItem",[n("div",{staticClass:"text-center"},[n("img",{staticStyle:{"object-fit":"contain",width:"320px",height:"310px"},attrs:{src:image.url}})])])],1)})),0)],1)],1)}),[],!1,null,"4924580c",null);e.default=component.exports}}]);